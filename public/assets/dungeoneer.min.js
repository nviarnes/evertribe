/*! Built with IMPACT - impactjs.com */
(function(a){"use strict",Number.prototype.map=function(a,b,c,d){return c+(d-c)*((this-a)/(b-a))},Number.prototype.limit=function(a,b){return Math.min(b,Math.max(a,this))},Number.prototype.round=function(a){return a=Math.pow(10,a||0),Math.round(this*a)/a},Number.prototype.floor=function(){return Math.floor(this)},Number.prototype.ceil=function(){return Math.ceil(this)},Number.prototype.toInt=function(){return this|0},Number.prototype.toRad=function(){return this/180*Math.PI},Number.prototype.toDeg=function(){return this*180/Math.PI},Array.prototype.erase=function(a){for(var b=this.length;b--;)this[b]===a&&this.splice(b,1);return this},Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]},Function.prototype.bind=Function.prototype.bind||function(a){var b=this;return function(){var c=Array.prototype.slice.call(arguments);return b.apply(a||null,c)}},a.ig={game:null,debug:null,version:"1.20",global:a,modules:{},resources:[],ready:!1,baked:!1,nocache:"",ua:{},prefix:a.ImpactPrefix||"",lib:"lib/",_current:null,_loadQueue:[],_waitForOnload:0,$:function(a){return a.charAt(0)=="#"?document.getElementById(a.substr(1)):document.getElementsByTagName(a)},$new:function(a){return document.createElement(a)},copy:function(a){if(!a||typeof a!="object"||a instanceof HTMLElement||a instanceof ig.Class)return a;if(a instanceof Array){var b=[];for(var c=0,d=a.length;c<d;c++)b[c]=ig.copy(a[c]);return b}var b={};for(var c in a)b[c]=ig.copy(a[c]);return b},merge:function(a,b){for(var c in b){var d=b[c];if(typeof d!="object"||d instanceof HTMLElement||d instanceof ig.Class)a[c]=d;else{if(!a[c]||typeof a[c]!="object")a[c]=d instanceof Array?[]:{};ig.merge(a[c],d)}}return a},ksort:function(a){if(!a||typeof a!="object")return[];var b=[],c=[];for(var d in a)b.push(d);b.sort();for(var d=0;d<b.length;d++)c.push(a[b[d]]);return c},module:function(a){if(ig._current)throw"Module '"+ig._current.name+"' defines nothing";if(ig.modules[a]&&ig.modules[a].body)throw"Module '"+a+"' is already defined";return ig._current={name:a,requires:[],loaded:!1,body:null},ig.modules[a]=ig._current,ig._loadQueue.push(ig._current),ig},requires:function(){return ig._current.requires=Array.prototype.slice.call(arguments),ig},defines:function(a){ig._current.body=a,ig._current=null,ig._initDOMReady()},addResource:function(a){ig.resources.push(a)},setNocache:function(a){ig.nocache=a?"?"+Date.now():""},log:function(){},assert:function(a,b){},show:function(a,b){},mark:function(a,b){},_loadScript:function(a,b){ig.modules[a]={name:a,requires:[],loaded:!1,body:null},ig._waitForOnload++;var c=ig.prefix+ig.lib+a.replace(/\./g,"/")+".js"+ig.nocache,d=ig.$new("script");d.type="text/javascript",d.src=c,d.onload=function(){ig._waitForOnload--,ig._execModules()},d.onerror=function(){throw"Failed to load module "+a+" at "+c+" "+"required from "+b},ig.$("head")[0].appendChild(d)},_execModules:function(){var a=!1;for(var b=0;b<ig._loadQueue.length;b++){var c=ig._loadQueue[b],d=!0;for(var e=0;e<c.requires.length;e++){var f=c.requires[e];ig.modules[f]?ig.modules[f].loaded||(d=!1):(d=!1,ig._loadScript(f,c.name))}d&&c.body&&(ig._loadQueue.splice(b,1),c.loaded=!0,c.body(),a=!0,b--)}if(a)ig._execModules();else if(!ig.baked&&ig._waitForOnload==0&&ig._loadQueue.length!=0){var g=[];for(var b=0;b<ig._loadQueue.length;b++){var h=[],i=ig._loadQueue[b].requires;for(var e=0;e<i.length;e++){var c=ig.modules[i[e]];(!c||!c.loaded)&&h.push(i[e])}g.push(ig._loadQueue[b].name+" (requires: "+h.join(", ")+")")}throw"Unresolved (circular?) dependencies. Most likely there's a name/path mismatch for one of the listed modules:\n"+g.join("\n")}},_DOMReady:function(){if(!ig.modules["dom.ready"].loaded){if(!document.body)return setTimeout(ig._DOMReady,13);ig.modules["dom.ready"].loaded=!0,ig._waitForOnload--,ig._execModules()}return 0},_boot:function(){document.location.href.match(/\?nocache/)&&ig.setNocache(!0),ig.ua.pixelRatio=a.devicePixelRatio||1,ig.ua.viewport={width:a.innerWidth,height:a.innerHeight},ig.ua.screen={width:a.screen.availWidth*ig.ua.pixelRatio,height:a.screen.availHeight*ig.ua.pixelRatio},ig.ua.iPhone=/iPhone/i.test(navigator.userAgent),ig.ua.iPhone4=ig.ua.iPhone&&ig.ua.pixelRatio==2,ig.ua.iPad=/iPad/i.test(navigator.userAgent),ig.ua.android=/android/i.test(navigator.userAgent),ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad,ig.ua.mobile=ig.ua.iOS||ig.ua.android},_initDOMReady:function(){if(ig.modules["dom.ready"]){ig._execModules();return}ig._boot(),ig.modules["dom.ready"]={requires:[],loaded:!1,body:null},ig._waitForOnload++,document.readyState==="complete"?ig._DOMReady():(document.addEventListener("DOMContentLoaded",ig._DOMReady,!1),a.addEventListener("load",ig._DOMReady,!1))}};var b=["ms","moz","webkit","o"];for(var c=0;c<b.length&&!a.requestAnimationFrame;c++)a.requestAnimationFrame=a[b[c]+"RequestAnimationFrame"];if(a.requestAnimationFrame){var d=1,e={};a.ig.setAnimation=function(b,c){var f=d++;e[f]=!0;var g=function(){if(!e[f])return;a.requestAnimationFrame(g,c),b()};return a.requestAnimationFrame(g,c),f},a.ig.clearAnimation=function(a){delete e[a]}}else a.ig.setAnimation=function(b,c){return a.setInterval(b,1e3/60)},a.ig.clearAnimation=function(b){a.clearInterval(b)};var f=!1,g=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/;a.ig.Class=function(){};var h=function(a){var b=this.prototype,c={};for(var d in a)typeof a[d]=="function"&&typeof b[d]=="function"&&g.test(a[d])?(c[d]=b[d],b[d]=function(a,b){return function(){var d=this.parent;this.parent=c[a];var e=b.apply(this,arguments);return this.parent=d,e}}(d,a[d])):b[d]=a[d]};a.ig.Class.extend=function(b){function i(){if(!f){if(this.staticInstantiate){var a=this.staticInstantiate.apply(this,arguments);if(a)return a}for(var b in this)typeof this[b]=="object"&&(this[b]=ig.copy(this[b]));this.init&&this.init.apply(this,arguments)}return this}var c=this.prototype;f=!0;var d=new this;f=!1;for(var e in b)typeof b[e]=="function"&&typeof c[e]=="function"&&g.test(b[e])?d[e]=function(a,b){return function(){var d=this.parent;this.parent=c[a];var e=b.apply(this,arguments);return this.parent=d,e}}(e,b[e]):d[e]=b[e];return i.prototype=d,i.constructor=i,i.extend=a.ig.Class.extend,i.inject=h,i}})(window),ig.baked=!0,ig.module("impact.image").defines(function(){"use strict",ig.Image=ig.Class.extend({data:null,width:0,height:0,loaded:!1,failed:!1,loadCallback:null,path:"",staticInstantiate:function(a){return ig.Image.cache[a]||null},init:function(a){this.path=a,this.load()},load:function(a){if(this.loaded){a&&a(this.path,!0);return}!this.loaded&&ig.ready?(this.loadCallback=a||null,this.data=new Image,this.data.onload=this.onload.bind(this),this.data.onerror=this.onerror.bind(this),this.data.src=ig.prefix+this.path+ig.nocache):ig.addResource(this),ig.Image.cache[this.path]=this},reload:function(){this.loaded=!1,this.data=new Image,this.data.onload=this.onload.bind(this),this.data.src=this.path+"?"+Date.now()},onload:function(a){this.width=this.data.width,this.height=this.data.height,this.loaded=!0,ig.system.scale!=1&&this.resize(ig.system.scale),this.loadCallback&&this.loadCallback(this.path,!0)},onerror:function(a){this.failed=!0,this.loadCallback&&this.loadCallback(this.path,!1)},resize:function(a){var b=this.width*a,c=this.height*a,d=ig.$new("canvas");d.width=this.width,d.height=this.height;var e=d.getContext("2d");e.drawImage(this.data,0,0,this.width,this.height,0,0,this.width,this.height);var f=e.getImageData(0,0,this.width,this.height),g=ig.$new("canvas");g.width=b,g.height=c;var h=g.getContext("2d"),i=h.getImageData(0,0,b,c);for(var j=0;j<c;j++)for(var k=0;k<b;k++){var l=(Math.floor(j/a)*this.width+Math.floor(k/a))*4,m=(j*b+k)*4;i.data[m]=f.data[l],i.data[m+1]=f.data[l+1],i.data[m+2]=f.data[l+2],i.data[m+3]=f.data[l+3]}h.putImageData(i,0,0),this.data=g},draw:function(a,b,c,d,e,f){if(!this.loaded)return;var g=ig.system.scale;c=c?c*g:0,d=d?d*g:0,e=(e?e:this.width)*g,f=(f?f:this.height)*g,ig.system.context.drawImage(this.data,c,d,e,f,ig.system.getDrawPos(a),ig.system.getDrawPos(b),e,f),ig.Image.drawCount++},drawTile:function(a,b,c,d,e,f,g){e=e?e:d;if(!this.loaded||d>this.width||e>this.height)return;var h=ig.system.scale,i=Math.floor(d*h),j=Math.floor(e*h),k=f?-1:1,l=g?-1:1;if(f||g)ig.system.context.save(),ig.system.context.scale(k,l);ig.system.context.drawImage(this.data,Math.floor(c*d)%this.width*h,Math.floor(c*d/this.width)*e*h,i,j,ig.system.getDrawPos(a)*k-(f?i:0),ig.system.getDrawPos(b)*l-(g?j:0),i,j),(f||g)&&ig.system.context.restore(),ig.Image.drawCount++}}),ig.Image.drawCount=0,ig.Image.cache={},ig.Image.reloadCache=function(){for(var a in ig.Image.cache)ig.Image.cache[a].reload()}}),ig.baked=!0,ig.module("impact.font").requires("impact.image").defines(function(){"use strict",ig.Font=ig.Image.extend({widthMap:[],indices:[],firstChar:32,alpha:1,letterSpacing:1,lineSpacing:0,onload:function(a){this._loadMetrics(this.data),this.parent(a)},widthForString:function(a){if(a.indexOf("\n")!==-1){var b=a.split("\n"),c=0;for(var d=0;d<b.length;d++)c=Math.max(c,this._widthForLine(b[d]));return c}return this._widthForLine(a)},_widthForLine:function(a){var b=0;for(var c=0;c<a.length;c++)b+=this.widthMap[a.charCodeAt(c)-this.firstChar]+this.letterSpacing;return b},heightForString:function(a){return a.split("\n").length*(this.height+this.lineSpacing)},draw:function(a,b,c,d){typeof a!="string"&&(a=a.toString());if(a.indexOf("\n")!==-1){var e=a.split("\n"),f=this.height+this.lineSpacing;for(var g=0;g<e.length;g++)this.draw(e[g],b,c+g*f,d);return}if(d==ig.Font.ALIGN.RIGHT||d==ig.Font.ALIGN.CENTER){var h=this._widthForLine(a);b-=d==ig.Font.ALIGN.CENTER?h/2:h}this.alpha!==1&&(ig.system.context.globalAlpha=this.alpha);for(var g=0;g<a.length;g++){var i=a.charCodeAt(g);b+=this._drawChar(i-this.firstChar,b,c)}this.alpha!==1&&(ig.system.context.globalAlpha=1),ig.Image.drawCount+=a.length},_drawChar:function(a,b,c){if(!this.loaded||a<0||a>=this.indices.length)return 0;var d=ig.system.scale,e=this.indices[a]*d,f=0,g=this.widthMap[a]*d,h=(this.height-2)*d;return ig.system.context.drawImage(this.data,e,f,g,h,ig.system.getDrawPos(b),ig.system.getDrawPos(c),g,h),this.widthMap[a]+this.letterSpacing},_loadMetrics:function(a){this.height=a.height-1,this.widthMap=[],this.indices=[];var b=ig.$new("canvas");b.width=a.width,b.height=a.height;var c=b.getContext("2d");c.drawImage(a,0,0);var d=c.getImageData(0,a.height-1,a.width,1),e=0,f=0;for(var g=0;g<a.width;g++){var h=g*4+3;d.data[h]!=0?f++:d.data[h]==0&&f&&(this.widthMap.push(f),this.indices.push(g-f),e++,f=0)}this.widthMap.push(f),this.indices.push(g-f)}}),ig.Font.ALIGN={LEFT:0,RIGHT:1,CENTER:2}}),ig.baked=!0,ig.module("impact.sound").defines(function(){"use strict",ig.SoundManager=ig.Class.extend({clips:{},volume:1,format:null,init:function(){var a=new Audio;for(var b=0;b<ig.Sound.use.length;b++){var c=ig.Sound.use[b];if(a.canPlayType(c.mime)){this.format=c;break}}this.format||(ig.Sound.enabled=!1)},load:function(a,b,c){var d=ig.prefix+a.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(this.clips[a]){if(b&&this.clips[a].length<ig.Sound.channels)for(var e=this.clips[a].length;e<ig.Sound.channels;e++){var f=new Audio(d);f.load(),this.clips[a].push(f)}return this.clips[a][0]}var g=new Audio(d);c&&(g.addEventListener("canplaythrough",function h(b){g.removeEventListener("canplaythrough",h,!1),c(a,!0,b)},!1),g.addEventListener("error",function(b){c(a,!1,b)},!1)),g.preload="auto",g.load(),this.clips[a]=[g];if(b)for(var e=1;e<ig.Sound.channels;e++){var f=new Audio(d);f.load(),this.clips[a].push(f)}return g},get:function(a){var b=this.clips[a];for(var c=0,d;d=b[c++];)if(d.paused||d.ended)return d.ended&&(d.currentTime=0),d;return b[0].pause(),b[0].currentTime=0,b[0]}}),ig.Music=ig.Class.extend({tracks:[],namedTracks:{},currentTrack:null,currentIndex:0,random:!1,_volume:1,_loop:!1,_fadeInterval:0,_fadeTimer:null,_endedCallbackBound:null,init:function(){this._endedCallbackBound=this._endedCallback.bind(this),Object.defineProperty?(Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)}),Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)})):this.__defineGetter__&&(this.__defineGetter__("volume",this.getVolume.bind(this)),this.__defineSetter__("volume",this.setVolume.bind(this)),this.__defineGetter__("loop",this.getLooping.bind(this)),this.__defineSetter__("loop",this.setLooping.bind(this)))},add:function(a,b){if(!ig.Sound.enabled)return;var c=a instanceof ig.Sound?a.path:a,d=ig.soundManager.load(c,!1);d.loop=this._loop,d.volume=this._volume,d.addEventListener("ended",this._endedCallbackBound,!1),this.tracks.push(d),b&&(this.namedTracks[b]=d),this.currentTrack||(this.currentTrack=d)},next:function(){if(!this.tracks.length)return;this.stop(),this.currentIndex=this.random?Math.floor(Math.random()*this.tracks.length):(this.currentIndex+1)%this.tracks.length,this.currentTrack=this.tracks[this.currentIndex],this.play()},pause:function(){if(!this.currentTrack)return;this.currentTrack.pause()},stop:function(){if(!this.currentTrack)return;this.currentTrack.pause(),this.currentTrack.currentTime=0},play:function(a){if(a&&this.namedTracks[a]){var b=this.namedTracks[a];b!=this.currentTrack&&(this.stop(),this.currentTrack=b)}else if(!this.currentTrack)return;this.currentTrack.play()},getLooping:function(){return this._loop},setLooping:function(a){this._loop=a;for(var b in this.tracks)this.tracks[b].loop=a},getVolume:function(){return this._volume},setVolume:function(a){this._volume=a.limit(0,1);for(var b in this.tracks)this.tracks[b].volume=this._volume},fadeOut:function(a){if(!this.currentTrack)return;clearInterval(this._fadeInterval),this.fadeTimer=new ig.Timer(a),this._fadeInterval=setInterval(this._fadeStep.bind(this),50)},_fadeStep:function(){var a=this.fadeTimer.delta().map(-this.fadeTimer.target,0,1,0).limit(0,1)*this._volume;a<=.01?(this.stop(),this.currentTrack.volume=this._volume,clearInterval(this._fadeInterval)):this.currentTrack.volume=a},_endedCallback:function(){this._loop?this.play():this.next()}}),ig.Sound=ig.Class.extend({path:"",volume:1,currentClip:null,multiChannel:!0,init:function(a,b){this.path=a,this.multiChannel=b!==!1,this.load()},load:function(a){if(!ig.Sound.enabled){a&&a(this.path,!0);return}ig.ready?ig.soundManager.load(this.path,this.multiChannel,a):ig.addResource(this)},play:function(){if(!ig.Sound.enabled)return;this.currentClip=ig.soundManager.get(this.path),this.currentClip.volume=ig.soundManager.volume*this.volume,this.currentClip.play()},stop:function(){this.currentClip&&(this.currentClip.pause(),this.currentClip.currentTime=0)}}),ig.Sound.FORMAT={MP3:{ext:"mp3",mime:"audio/mpeg"},M4A:{ext:"m4a",mime:"audio/mp4; codecs=mp4a"},OGG:{ext:"ogg",mime:"audio/ogg; codecs=vorbis"},WEBM:{ext:"webm",mime:"audio/webm; codecs=vorbis"},CAF:{ext:"caf",mime:"audio/x-caf"}},ig.Sound.use=[ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.MP3],ig.Sound.channels=4,ig.Sound.enabled=!0}),ig.baked=!0,ig.module("impact.loader").requires("impact.image","impact.font","impact.sound").defines(function(){"use strict",ig.Loader=ig.Class.extend({resources:[],gameClass:null,status:0,done:!1,_unloaded:[],_drawStatus:0,_intervalId:0,_loadCallbackBound:null,init:function(a,b){this.gameClass=a,this.resources=b,this._loadCallbackBound=this._loadCallback.bind(this);for(var c=0;c<this.resources.length;c++)this._unloaded.push(this.resources[c].path)},load:function(){ig.system.clear("#000");if(!this.resources.length){this.end();return}for(var a=0;a<this.resources.length;a++)this.loadResource(this.resources[a]);this._intervalId=setInterval(this.draw.bind(this),16)},loadResource:function(a){a.load(this._loadCallbackBound)},end:function(){if(this.done)return;this.done=!0,clearInterval(this._intervalId),ig.system.setGame(this.gameClass)},draw:function(){this._drawStatus+=(this.status-this._drawStatus)/5;var a=ig.system.scale,b=ig.system.width*.6,c=ig.system.height*.1,d=ig.system.width*.5-b/2,e=ig.system.height*.5-c/2;ig.system.context.fillStyle="#000",ig.system.context.fillRect(0,0,480,320),ig.system.context.fillStyle="#fff",ig.system.context.fillRect(d*a,e*a,b*a,c*a),ig.system.context.fillStyle="#000",ig.system.context.fillRect(d*a+a,e*a+a,b*a-a-a,c*a-a-a),ig.system.context.fillStyle="#fff",ig.system.context.fillRect(d*a,e*a,b*a*this._drawStatus,c*a)},_loadCallback:function(a,b){if(!b)throw"Failed to load resource: "+a;this._unloaded.erase(a),this.status=1-this._unloaded.length/this.resources.length,this._unloaded.length==0&&setTimeout(this.end.bind(this),250)}})}),ig.baked=!0,ig.module("impact.timer").defines(function(){"use strict",ig.Timer=ig.Class.extend({target:0,base:0,last:0,pausedAt:0,init:function(a){this.base=ig.Timer.time,this.last=ig.Timer.time,this.target=a||0},set:function(a){this.target=a||0,this.base=ig.Timer.time,this.pausedAt=0},reset:function(){this.base=ig.Timer.time,this.pausedAt=0},tick:function(){var a=ig.Timer.time-this.last;return this.last=ig.Timer.time,this.pausedAt?0:a},delta:function(){return(this.pausedAt||ig.Timer.time)-this.base-this.target},pause:function(){this.pausedAt||(this.pausedAt=ig.Timer.time)},unpause:function(){this.pausedAt&&(this.base+=ig.Timer.time-this.pausedAt,this.pausedAt=0)}}),ig.Timer._last=0,ig.Timer.time=0,ig.Timer.timeScale=1,ig.Timer.maxStep=.05,ig.Timer.step=function(){var a=Date.now(),b=(a-ig.Timer._last)/1e3;ig.Timer.time+=Math.min(b,ig.Timer.maxStep)*ig.Timer.timeScale,ig.Timer._last=a}}),ig.baked=!0,ig.module("impact.system").requires("impact.timer","impact.image").defines(function(){"use strict",ig.System=ig.Class.extend({fps:30,width:320,height:240,realWidth:320,realHeight:240,scale:1,tick:0,animationId:0,newGameClass:null,running:!1,delegate:null,clock:null,canvas:null,context:null,init:function(a,b,c,d,e){this.fps=b,this.clock=new ig.Timer,this.canvas=ig.$(a),this.resize(c,d,e),this.context=this.canvas.getContext("2d"),this.getDrawPos=ig.System.drawMode},resize:function(a,b,c){this.width=a,this.height=b,this.scale=c||this.scale,this.realWidth=this.width*this.scale,this.realHeight=this.height*this.scale,this.canvas.width=this.realWidth,this.canvas.height=this.realHeight},setGame:function(a){this.running?this.newGameClass=a:this.setGameNow(a)},setGameNow:function(a){ig.game=new a,ig.system.setDelegate(ig.game)},setDelegate:function(a){if(typeof a.run!="function")throw"System.setDelegate: No run() function in object";this.delegate=a,this.startRunLoop()},stopRunLoop:function(){ig.clearAnimation(this.animationId),this.running=!1},startRunLoop:function(){this.stopRunLoop(),this.animationId=ig.setAnimation(this.run.bind(this),this.canvas),this.running=!0},clear:function(a){this.context.fillStyle=a,this.context.fillRect(0,0,this.realWidth,this.realHeight)},run:function(){ig.Timer.step(),this.tick=this.clock.tick(),this.delegate.run(),ig.input.clearPressed(),this.newGameClass&&(this.setGameNow(this.newGameClass),this.newGameClass=null)},getDrawPos:null}),ig.System.DRAW={AUTHENTIC:function(a){return Math.round(a)*this.scale},SMOOTH:function(a){return Math.round(a*this.scale)},SUBPIXEL:function(a){return a*this.scale}},ig.System.drawMode=ig.System.DRAW.SMOOTH}),ig.baked=!0,ig.module("impact.input").defines(function(){"use strict",ig.KEY={MOUSE1:-1,MOUSE2:-3,MWHEEL_UP:-4,MWHEEL_DOWN:-5,BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,_0:48,_1:49,_2:50,_3:51,_4:52,_5:53,_6:54,_7:55,_8:56,_9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190},ig.Input=ig.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},isUsingMouse:!1,isUsingKeyboard:!1,isUsingAccelerometer:!1,mouse:{x:0,y:0},accel:{x:0,y:0,z:0},initMouse:function(){if(this.isUsingMouse)return;this.isUsingMouse=!0;var a=this.mousewheel.bind(this);ig.system.canvas.addEventListener("mousewheel",a,!1),ig.system.canvas.addEventListener("DOMMouseScroll",a,!1),ig.system.canvas.addEventListener("contextmenu",this.contextmenu.bind(this),!1),ig.system.canvas.addEventListener("mousedown",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("mouseup",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("mousemove",this.mousemove.bind(this),!1),ig.system.canvas.addEventListener("touchstart",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("touchend",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("touchmove",this.mousemove.bind(this),!1)},initKeyboard:function(){if(this.isUsingKeyboard)return;this.isUsingKeyboard=!0,window.addEventListener("keydown",this.keydown.bind(this),!1),window.addEventListener("keyup",this.keyup.bind(this),!1)},initAccelerometer:function(){if(this.isUsingAccelerometer)return;window.addEventListener("devicemotion",this.devicemotion.bind(this),!1)},mousewheel:function(a){var b=a.wheelDelta?a.wheelDelta:a.detail*-1,c=b>0?ig.KEY.MWHEEL_UP:ig.KEY.MWHEEL_DOWN,d=this.bindings[c];d&&(this.actions[d]=!0,this.presses[d]=!0,this.delayedKeyup[d]=!0,a.stopPropagation(),a.preventDefault())},mousemove:function(a){var b=ig.system.canvas,c={left:0,top:0};while(b!=null)c.left+=b.offsetLeft,c.top+=b.offsetTop,b=b.offsetParent;var d=a.pageX,e=a.pageY;a.touches&&(d=a.touches[0].clientX,e=a.touches[0].clientY),this.mouse.x=(d-c.left)/ig.system.scale,this.mouse.y=(e-c.top)/ig.system.scale},contextmenu:function(a){this.bindings[ig.KEY.MOUSE2]&&(a.stopPropagation(),a.preventDefault())},keydown:function(a){if(a.target.type=="text")return;var b=a.type=="keydown"?a.keyCode:a.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1;(a.type=="touchstart"||a.type=="mousedown")&&this.mousemove(a);var c=this.bindings[b];c&&(this.actions[c]=!0,this.locks[c]||(this.presses[c]=!0,this.locks[c]=!0),a.stopPropagation(),a.preventDefault())},keyup:function(a){if(a.target.type=="text")return;var b=a.type=="keyup"?a.keyCode:a.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1,c=this.bindings[b];c&&(this.delayedKeyup[c]=!0,a.stopPropagation(),a.preventDefault())},devicemotion:function(a){this.accel=a.accelerationIncludingGravity},bind:function(a,b){a<0?this.initMouse():a>0&&this.initKeyboard(),this.bindings[a]=b},bindTouch:function(a,b){var c=ig.$(a),d=this;c.addEventListener("touchstart",function(a){d.touchStart(a,b)},!1),c.addEventListener("touchend",function(a){d.touchEnd(a,b)},!1)},unbind:function(a){var b=this.bindings[a];this.delayedKeyup[b]=!0,this.bindings[a]=null},unbindAll:function(){this.bindings={},this.actions={},this.presses={},this.locks={},this.delayedKeyup={}},state:function(a){return this.actions[a]},pressed:function(a){return this.presses[a]},released:function(a){return this.delayedKeyup[a]},clearPressed:function(){for(var a in this.delayedKeyup)this.actions[a]=!1,this.locks[a]=!1;this.delayedKeyup={},this.presses={}},touchStart:function(a,b){return this.actions[b]=!0,this.presses[b]=!0,a.stopPropagation(),a.preventDefault(),!1},touchEnd:function(a,b){return this.delayedKeyup[b]=!0,a.stopPropagation(),a.preventDefault(),!1}})}),ig.baked=!0,ig.module("impact.impact").requires("dom.ready","impact.loader","impact.system","impact.input","impact.sound").defines(function(){"use strict",ig.main=function(a,b,c,d,e,f,g){ig.system=new ig.System(a,c,d,e,f||1),ig.input=new ig.Input,ig.soundManager=new ig.SoundManager,ig.music=new ig.Music,ig.ready=!0;var h=new(g||ig.Loader)(b,ig.resources);h.load()}}),ig.baked=!0,ig.module("impact.animation").requires("impact.timer","impact.image").defines(function(){"use strict",ig.AnimationSheet=ig.Class.extend({width:8,height:8,image:null,init:function(a,b,c){this.width=b,this.height=c,this.image=new ig.Image(a)}}),ig.Animation=ig.Class.extend({sheet:null,timer:null,sequence:[],flip:{x:!1,y:!1},pivot:{x:0,y:0},frame:0,tile:0,loopCount:0,alpha:1,angle:0,init:function(a,b,c,d){this.sheet=a,this.pivot={x:a.width/2,y:a.height/2},this.timer=new ig.Timer,this.frameTime=b,this.sequence=c,this.stop=!!d,this.tile=this.sequence[0]},rewind:function(){return this.timer.reset(),this.loopCount=0,this.tile=this.sequence[0],this},gotoFrame:function(a){this.timer.set(this.frameTime*-a),this.update()},gotoRandomFrame:function(){this.gotoFrame(Math.floor(Math.random()*this.sequence.length))},update:function(){var a=Math.floor(this.timer.delta()/this.frameTime);this.loopCount=Math.floor(a/this.sequence.length),this.stop&&this.loopCount>0?this.frame=this.sequence.length-1:this.frame=a%this.sequence.length,this.tile=this.sequence[this.frame]},draw:function(a,b){var c=Math.max(this.sheet.width,this.sheet.height);if(a>ig.system.width||b>ig.system.height||a+c<0||b+c<0)return;this.alpha!=1&&(ig.system.context.globalAlpha=this.alpha),this.angle==0?this.sheet.image.drawTile(a,b,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y):(ig.system.context.save(),ig.system.context.translate(ig.system.getDrawPos(a+this.pivot.x),ig.system.getDrawPos(b+this.pivot.y)),ig.system.context.rotate(this.angle),this.sheet.image.drawTile(-this.pivot.x,-this.pivot.y,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y),ig.system.context.restore()),this.alpha!=1&&(ig.system.context.globalAlpha=1)}})}),ig.baked=!0,ig.module("impact.entity").requires("impact.animation","impact.impact").defines(function(){"use strict",ig.Entity=ig.Class.extend({id:0,settings:{},size:{x:16,y:16},offset:{x:0,y:0},pos:{x:0,y:0},last:{x:0,y:0},vel:{x:0,y:0},accel:{x:0,y:0},friction:{x:0,y:0},maxVel:{x:100,y:100},zIndex:0,gravityFactor:1,standing:!1,bounciness:0,minBounceVelocity:40,anims:{},animSheet:null,currentAnim:null,health:10,type:0,checkAgainst:0,collides:0,_killed:!1,slopeStanding:{min:44..toRad(),max:136..toRad()},init:function(a,b,c){this.id=++ig.Entity._lastId,this.pos.x=a,this.pos.y=b,ig.merge(this,c)},addAnim:function(a,b,c,d){if(!this.animSheet)throw"No animSheet to add the animation "+a+" to.";var e=new ig.Animation(this.animSheet,b,c,d);return this.anims[a]=e,this.currentAnim||(this.currentAnim=e),e},update:function(){this.last.x=this.pos.x,this.last.y=this.pos.y,this.vel.y+=ig.game.gravity*ig.system.tick*this.gravityFactor,this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x),this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);var a=this.vel.x*ig.system.tick,b=this.vel.y*ig.system.tick,c=ig.game.collisionMap.trace(this.pos.x,this.pos.y,a,b,this.size.x,this.size.y);this.handleMovementTrace(c),this.currentAnim&&this.currentAnim.update()},getNewVelocity:function(a,b,c,d){if(b)return(a+b*ig.system.tick).limit(-d,d);if(c){var e=c*ig.system.tick;return a-e>0?a-e:a+e<0?a+e:0}return a.limit(-d,d)},handleMovementTrace:function(a){this.standing=!1,a.collision.y&&(this.bounciness>0&&Math.abs(this.vel.y)>this.minBounceVelocity?this.vel.y*=-this.bounciness:(this.vel.y>0&&(this.standing=!0),this.vel.y=0)),a.collision.x&&(this.bounciness>0&&Math.abs(this.vel.x)>this.minBounceVelocity?this.vel.x*=-this.bounciness:this.vel.x=0);if(a.collision.slope){var b=a.collision.slope;if(this.bounciness>0){var c=this.vel.x*b.nx+this.vel.y*b.ny;this.vel.x=(this.vel.x-b.nx*c*2)*this.bounciness,this.vel.y=(this.vel.y-b.ny*c*2)*this.bounciness}else{var d=b.x*b.x+b.y*b.y,e=(this.vel.x*b.x+this.vel.y*b.y)/d;this.vel.x=b.x*e,this.vel.y=b.y*e;var f=Math.atan2(b.x,b.y);f>this.slopeStanding.min&&f<this.slopeStanding.max&&(this.standing=!0)}}this.pos=a.pos},draw:function(){this.currentAnim&&this.currentAnim.draw(this.pos.x-this.offset.x-ig.game._rscreen.x,this.pos.y-this.offset.y-ig.game._rscreen.y)},kill:function(){ig.game.removeEntity(this)},receiveDamage:function(a,b){this.health-=a,this.health<=0&&this.kill()},touches:function(a){return!(this.pos.x>=a.pos.x+a.size.x||this.pos.x+this.size.x<=a.pos.x||this.pos.y>=a.pos.y+a.size.y||this.pos.y+this.size.y<=a.pos.y)},distanceTo:function(a){var b=this.pos.x+this.size.x/2-(a.pos.x+a.size.x/2),c=this.pos.y+this.size.y/2-(a.pos.y+a.size.y/2);return Math.sqrt(b*b+c*c)},angleTo:function(a){return Math.atan2(a.pos.y+a.size.y/2-(this.pos.y+this.size.y/2),a.pos.x+a.size.x/2-(this.pos.x+this.size.x/2))},check:function(a){},collideWith:function(a,b){},ready:function(){}}),ig.Entity._lastId=0,ig.Entity.COLLIDES={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8},ig.Entity.TYPE={NONE:0,A:1,B:2,BOTH:3},ig.Entity.checkPair=function(a,b){a.checkAgainst&b.type&&a.check(b),b.checkAgainst&a.type&&b.check(a),a.collides&&b.collides&&a.collides+b.collides>ig.Entity.COLLIDES.ACTIVE&&ig.Entity.solveCollision(a,b)},ig.Entity.solveCollision=function(a,b){var c=null;if(a.collides==ig.Entity.COLLIDES.LITE||b.collides==ig.Entity.COLLIDES.FIXED)c=a;else if(b.collides==ig.Entity.COLLIDES.LITE||a.collides==ig.Entity.COLLIDES.FIXED)c=b;a.last.x+a.size.x>b.last.x&&a.last.x<b.last.x+b.size.x?(a.last.y<b.last.y?ig.Entity.seperateOnYAxis(a,b,c):ig.Entity.seperateOnYAxis(b,a,c),a.collideWith(b,"y"),b.collideWith(a,"y")):a.last.y+a.size.y>b.last.y&&a.last.y<b.last.y+b.size.y&&(a.last.x<b.last.x?ig.Entity.seperateOnXAxis(a,b,c):ig.Entity.seperateOnXAxis(b,a,c),a.collideWith(b,"x"),b.collideWith(a,"x"))},ig.Entity.seperateOnXAxis=function(a,b,c){var d=a.pos.x+a.size.x-b.pos.x;if(c){var e=a===c?b:a;c.vel.x=-c.vel.x*c.bounciness+e.vel.x;var f=ig.game.collisionMap.trace(c.pos.x,c.pos.y,c==a?-d:d,0,c.size.x,c.size.y);c.pos.x=f.pos.x}else{var g=(a.vel.x-b.vel.x)/2;a.vel.x=-g,b.vel.x=g;var h=ig.game.collisionMap.trace(a.pos.x,a.pos.y,-d/2,0,a.size.x,a.size.y);a.pos.x=Math.floor(h.pos.x);var i=ig.game.collisionMap.trace(b.pos.x,b.pos.y,d/2,0,b.size.x,b.size.y);b.pos.x=Math.ceil(i.pos.x)}},ig.Entity.seperateOnYAxis=function(a,b,c){var d=a.pos.y+a.size.y-b.pos.y;if(c){var e=a===c?b:a;c.vel.y=-c.vel.y*c.bounciness+e.vel.y;var f=0;c==a&&Math.abs(c.vel.y-e.vel.y)<c.minBounceVelocity&&(c.standing=!0,f=e.vel.x*ig.system.tick);var g=ig.game.collisionMap.trace(c.pos.x,c.pos.y,f,c==a?-d:d,c.size.x,c.size.y);c.pos.y=g.pos.y,c.pos.x=g.pos.x}else if(ig.game.gravity&&(b.standing||a.vel.y>0)){var h=ig.game.collisionMap.trace(a.pos.x,a.pos.y,0,-(a.pos.y+a.size.y-b.pos.y),a.size.x,a.size.y);a.pos.y=h.pos.y,a.bounciness>0&&a.vel.y>a.minBounceVelocity?a.vel.y*=-a.bounciness:(a.standing=!0,a.vel.y=0)}else{var i=(a.vel.y-b.vel.y)/2;a.vel.y=-i,b.vel.y=i;var f=b.vel.x*ig.system.tick,h=ig.game.collisionMap.trace(a.pos.x,a.pos.y,f,-d/2,a.size.x,a.size.y);a.pos.y=h.pos.y;var j=ig.game.collisionMap.trace(b.pos.x,b.pos.y,0,d/2,b.size.x,b.size.y);b.pos.y=j.pos.y}}}),ig.baked=!0,ig.module("impact.map").defines(function(){"use strict",ig.Map=ig.Class.extend({tilesize:8,width:1,height:1,data:[[]],name:null,init:function(a,b){this.tilesize=a,this.data=b,this.height=b.length,this.width=b[0].length},getTile:function(a,b){var c=Math.floor(a/this.tilesize),d=Math.floor(b/this.tilesize);return c>=0&&c<this.width&&d>=0&&d<this.height?this.data[d][c]:0},setTile:function(a,b,c){var d=Math.floor(a/this.tilesize),e=Math.floor(b/this.tilesize);d>=0&&d<this.width&&e>=0&&e<this.height&&(this.data[e][d]=c)}})}),ig.baked=!0,ig.module("impact.collision-map").requires("impact.map").defines(function(){"use strict",ig.CollisionMap=ig.Map.extend({lastSlope:1,tiledef:null,init:function(a,b,c){this.parent(a,b),this.tiledef=c||ig.CollisionMap.defaultTileDef;for(var d in this.tiledef)d|0>this.lastSlope&&(this.lastSlope=d|0)},trace:function(a,b,c,d,e,f){var g={collision:{x:!1,y:!1,slope:!1},pos:{x:a,y:b},tile:{x:0,y:0}},h=Math.ceil(Math.max(Math.abs(c),Math.abs(d))/this.tilesize);if(h>1){var i=c/h,j=d/h;for(var k=0;k<h&&(i||j);k++){this._traceStep(g,a,b,i,j,e,f,c,d,k),a=g.pos.x,b=g.pos.y,g.collision.x&&(i=0,c=0),g.collision.y&&(j=0,d=0);if(g.collision.slope)break}}else this._traceStep(g,a,b,c,d,e,f,c,d,0);return g},_traceStep:function(a,b,c,d,e,f,g,h,i,j){a.pos.x+=d,a.pos.y+=e;var k=0;if(d){var l=d>0?f:0,m=d<0?this.tilesize:0,n=Math.max(Math.floor(c/this.tilesize),0),o=Math.min(Math.ceil((c+g)/this.tilesize),this.height),p=Math.floor((a.pos.x+l)/this.tilesize),q=Math.floor((b+l)/this.tilesize);if(j>0||p==q||q<0||q>=this.width)q=-1;if(p>=0&&p<this.width)for(var r=n;r<o;r++){if(q!=-1){k=this.data[r][q];if(k>1&&k<=this.lastSlope&&this._checkTileDef(a,k,b,c,h,i,f,g,q,r))break}k=this.data[r][p];if(k==1||k>this.lastSlope||k>1&&this._checkTileDef(a,k,b,c,h,i,f,g,p,r)){if(k>1&&k<=this.lastSlope&&a.collision.slope)break;a.collision.x=!0,a.tile.x=k,b=a.pos.x=p*this.tilesize-l+m,h=0;break}}}if(e){var s=e>0?g:0,t=e<0?this.tilesize:0,u=Math.max(Math.floor
(a.pos.x/this.tilesize),0),v=Math.min(Math.ceil((a.pos.x+f)/this.tilesize),this.width),r=Math.floor((a.pos.y+s)/this.tilesize),w=Math.floor((c+s)/this.tilesize);if(j>0||r==w||w<0||w>=this.height)w=-1;if(r>=0&&r<this.height)for(var p=u;p<v;p++){if(w!=-1){k=this.data[w][p];if(k>1&&k<=this.lastSlope&&this._checkTileDef(a,k,b,c,h,i,f,g,p,w))break}k=this.data[r][p];if(k==1||k>this.lastSlope||k>1&&this._checkTileDef(a,k,b,c,h,i,f,g,p,r)){if(k>1&&k<=this.lastSlope&&a.collision.slope)break;a.collision.y=!0,a.tile.y=k,a.pos.y=r*this.tilesize-s+t;break}}}},_checkTileDef:function(a,b,c,d,e,f,g,h,i,j){var k=this.tiledef[b];if(!k)return!1;var l=(i+k[0])*this.tilesize,m=(j+k[1])*this.tilesize,n=(k[2]-k[0])*this.tilesize,o=(k[3]-k[1])*this.tilesize,p=k[4],q=c+e+(o<0?g:0)-l,r=d+f+(n>0?h:0)-m;if(n*r-o*q>0){if(e*-o+f*n<0)return p;var s=Math.sqrt(n*n+o*o),t=o/s,u=-n/s,v=q*t+r*u,w=t*v,x=u*v;return w*w+x*x>=e*e+f*f?p||n*(r-f)-o*(q-e)<.5:(a.pos.x=c+e-w,a.pos.y=d+f-x,a.collision.slope={x:n,y:o,nx:t,ny:u},!0)}return!1}});var a=.5,b=1/3,c=2/3,d=!0,e=!1;ig.CollisionMap.defaultTileDef={5:[0,1,1,c,d],6:[0,c,1,b,d],7:[0,b,1,0,d],3:[0,1,1,a,d],4:[0,a,1,0,d],2:[0,1,1,0,d],10:[a,1,1,0,d],21:[0,1,a,0,d],32:[c,1,1,0,d],43:[b,1,c,0,d],54:[0,1,b,0,d],27:[0,0,1,b,d],28:[0,b,1,c,d],29:[0,c,1,1,d],25:[0,0,1,a,d],26:[0,a,1,1,d],24:[0,0,1,1,d],11:[0,0,a,1,d],22:[a,0,1,1,d],33:[0,0,b,1,d],44:[b,0,c,1,d],55:[c,0,1,1,d],16:[1,b,0,0,d],17:[1,c,0,b,d],18:[1,1,0,c,d],14:[1,a,0,0,d],15:[1,1,0,a,d],13:[1,1,0,0,d],8:[a,1,0,0,d],19:[1,1,a,0,d],30:[b,1,0,0,d],41:[c,1,b,0,d],52:[1,1,c,0,d],38:[1,c,0,1,d],39:[1,b,0,c,d],40:[1,0,0,b,d],36:[1,a,0,1,d],37:[1,0,0,a,d],35:[1,0,0,1,d],9:[1,0,a,1,d],20:[a,0,0,1,d],31:[1,0,c,1,d],42:[c,0,b,1,d],53:[b,0,0,1,d],12:[0,0,1,0,e],23:[1,1,0,1,e],34:[1,0,1,1,e],45:[0,1,0,0,e]},ig.CollisionMap.staticNoCollision={trace:function(a,b,c,d){return{collision:{x:!1,y:!1,slope:!1},pos:{x:a+c,y:b+d},tile:{x:0,y:0}}}}}),ig.baked=!0,ig.module("impact.background-map").requires("impact.map","impact.image").defines(function(){"use strict",ig.BackgroundMap=ig.Map.extend({tiles:null,scroll:{x:0,y:0},distance:1,repeat:!1,tilesetName:"",foreground:!1,enabled:!0,preRender:!1,preRenderedChunks:null,chunkSize:512,debugChunks:!1,anims:{},init:function(a,b,c){this.parent(a,b),this.setTileset(c)},setTileset:function(a){this.tilesetName=a instanceof ig.Image?a.path:a,this.tiles=new ig.Image(this.tilesetName),this.preRenderedChunks=null},setScreenPos:function(a,b){this.scroll.x=a/this.distance,this.scroll.y=b/this.distance},preRenderMapToChunks:function(){var a=this.width*this.tilesize*ig.system.scale,b=this.height*this.tilesize*ig.system.scale,c=Math.ceil(a/this.chunkSize),d=Math.ceil(b/this.chunkSize);this.preRenderedChunks=[];for(var e=0;e<d;e++){this.preRenderedChunks[e]=[];for(var f=0;f<c;f++){var g=f==c-1?a-f*this.chunkSize:this.chunkSize,h=e==d-1?b-e*this.chunkSize:this.chunkSize;this.preRenderedChunks[e][f]=this.preRenderChunk(f,e,g,h)}}},preRenderChunk:function(a,b,c,d){var e=c/this.tilesize/ig.system.scale+1,f=d/this.tilesize/ig.system.scale+1,g=a*this.chunkSize/ig.system.scale%this.tilesize,h=b*this.chunkSize/ig.system.scale%this.tilesize,i=Math.floor(a*this.chunkSize/this.tilesize/ig.system.scale),j=Math.floor(b*this.chunkSize/this.tilesize/ig.system.scale),k=ig.$new("canvas");k.width=c,k.height=d;var l=ig.system.context;ig.system.context=k.getContext("2d");for(var m=0;m<e;m++)for(var n=0;n<f;n++)if(m+i<this.width&&n+j<this.height){var o=this.data[n+j][m+i];o&&this.tiles.drawTile(m*this.tilesize-g,n*this.tilesize-h,o-1,this.tilesize)}return ig.system.context=l,k},draw:function(){if(!this.tiles.loaded||!this.enabled)return;this.preRender?this.drawPreRendered():this.drawTiled()},drawPreRendered:function(){this.preRenderedChunks||this.preRenderMapToChunks();var a=ig.system.getDrawPos(this.scroll.x),b=ig.system.getDrawPos(this.scroll.y);this.repeat&&(a%=this.width*this.tilesize*ig.system.scale,b%=this.height*this.tilesize*ig.system.scale);var c=Math.max(Math.floor(a/this.chunkSize),0),d=Math.max(Math.floor(b/this.chunkSize),0),e=Math.ceil((a+ig.system.realWidth)/this.chunkSize),f=Math.ceil((b+ig.system.realHeight)/this.chunkSize),g=this.preRenderedChunks[0].length,h=this.preRenderedChunks.length;this.repeat||(e=Math.min(e,g),f=Math.min(f,h));var i=0;for(var j=d;j<f;j++){var k=0;for(var l=c;l<e;l++){var m=this.preRenderedChunks[j%h][l%g],n=-a+l*this.chunkSize-k,o=-b+j*this.chunkSize-i;ig.system.context.drawImage(m,n,o),ig.Image.drawCount++,this.debugChunks&&(ig.system.context.strokeStyle="#f0f",ig.system.context.strokeRect(n,o,this.chunkSize,this.chunkSize)),this.repeat&&m.width<this.chunkSize&&n+m.width<ig.system.realWidth&&(k=this.chunkSize-m.width,e++)}this.repeat&&m.height<this.chunkSize&&o+m.height<ig.system.realHeight&&(i=this.chunkSize-m.height,f++)}},drawTiled:function(){var a=0,b=null,c=(this.scroll.x/this.tilesize).toInt(),d=(this.scroll.y/this.tilesize).toInt(),e=this.scroll.x%this.tilesize,f=this.scroll.y%this.tilesize,g=-e-this.tilesize,h=-f-this.tilesize,i=ig.system.width+this.tilesize-e,j=ig.system.height+this.tilesize-f;for(var k=-1,l=h;l<j;k++,l+=this.tilesize){var m=k+d;if(m>=this.height||m<0){if(!this.repeat)continue;m=m>0?m%this.height:(m+1)%this.height+this.height-1}for(var n=-1,o=g;o<i;n++,o+=this.tilesize){var p=n+c;if(p>=this.width||p<0){if(!this.repeat)continue;p=p>0?p%this.width:(p+1)%this.width+this.width-1}if(a=this.data[m][p])(b=this.anims[a-1])?b.draw(o,l):this.tiles.drawTile(o,l,a-1,this.tilesize)}}}})}),ig.baked=!0,ig.module("impact.game").requires("impact.impact","impact.entity","impact.collision-map","impact.background-map").defines(function(){"use strict",ig.Game=ig.Class.extend({clearColor:"#000000",gravity:0,screen:{x:0,y:0},_rscreen:{x:0,y:0},entities:[],namedEntities:{},collisionMap:ig.CollisionMap.staticNoCollision,backgroundMaps:[],backgroundAnims:{},autoSort:!1,sortBy:null,cellSize:64,_deferredKill:[],_levelToLoad:null,_doSortEntities:!1,staticInstantiate:function(){return this.sortBy=this.sortBy||ig.Game.SORT.Z_INDEX,ig.game=this,null},loadLevel:function(a){this.screen={x:0,y:0},this.entities=[],this.namedEntities={};for(var b=0;b<a.entities.length;b++){var c=a.entities[b];this.spawnEntity(c.type,c.x,c.y,c.settings)}this.sortEntities(),this.collisionMap=ig.CollisionMap.staticNoCollision,this.backgroundMaps=[];for(var b=0;b<a.layer.length;b++){var d=a.layer[b];if(d.name=="collision")this.collisionMap=new ig.CollisionMap(d.tilesize,d.data);else{var e=new ig.BackgroundMap(d.tilesize,d.data,d.tilesetName);e.anims=this.backgroundAnims[d.tilesetName]||{},e.repeat=d.repeat,e.distance=d.distance,e.foreground=!!d.foreground,e.preRender=!!d.preRender,e.name=d.name,this.backgroundMaps.push(e)}}for(var b=0;b<this.entities.length;b++)this.entities[b].ready()},loadLevelDeferred:function(a){this._levelToLoad=a},getMapByName:function(a){if(a=="collision")return this.collisionMap;for(var b=0;b<this.backgroundMaps.length;b++)if(this.backgroundMaps[b].name==a)return this.backgroundMaps[b];return null},getEntityByName:function(a){return this.namedEntities[a]},getEntitiesByType:function(a){var b=typeof a=="string"?ig.global[a]:a,c=[];for(var d=0;d<this.entities.length;d++){var e=this.entities[d];e instanceof b&&!e._killed&&c.push(e)}return c},spawnEntity:function(a,b,c,d){var e=typeof a=="string"?ig.global[a]:a;if(!e)throw"Can't spawn entity of type "+a;var f=new e(b,c,d||{});return this.entities.push(f),f.name&&(this.namedEntities[f.name]=f),f},sortEntities:function(){this.entities.sort(this.sortBy)},sortEntitiesDeferred:function(){this._doSortEntities=!0},removeEntity:function(a){a.name&&delete this.namedEntities[a.name],a._killed=!0,a.type=ig.Entity.TYPE.NONE,a.checkAgainst=ig.Entity.TYPE.NONE,a.collides=ig.Entity.COLLIDES.NEVER,this._deferredKill.push(a)},run:function(){this.update(),this.draw()},update:function(){this._levelToLoad&&(this.loadLevel(this._levelToLoad),this._levelToLoad=null);if(this._doSortEntities||this.autoSort)this.sortEntities(),this._doSortEntities=!1;this.updateEntities(),this.checkEntities();for(var a=0;a<this._deferredKill.length;a++)this.entities.erase(this._deferredKill[a]);this._deferredKill=[];for(var b in this.backgroundAnims){var c=this.backgroundAnims[b];for(var d in c)c[d].update()}},updateEntities:function(){for(var a=0;a<this.entities.length;a++){var b=this.entities[a];b._killed||b.update()}},draw:function(){this.clearColor&&ig.system.clear(this.clearColor),this._rscreen.x=ig.system.getDrawPos(this.screen.x)/ig.system.scale,this._rscreen.y=ig.system.getDrawPos(this.screen.y)/ig.system.scale;var a;for(a=0;a<this.backgroundMaps.length;a++){var b=this.backgroundMaps[a];if(b.foreground)break;b.setScreenPos(this.screen.x,this.screen.y),b.draw()}this.drawEntities();for(a;a<this.backgroundMaps.length;a++){var b=this.backgroundMaps[a];b.setScreenPos(this.screen.x,this.screen.y),b.draw()}},drawEntities:function(){for(var a=0;a<this.entities.length;a++)this.entities[a].draw()},checkEntities:function(){var a={};for(var b=0;b<this.entities.length;b++){var c=this.entities[b];if(c.type==ig.Entity.TYPE.NONE&&c.checkAgainst==ig.Entity.TYPE.NONE&&c.collides==ig.Entity.COLLIDES.NEVER)continue;var d={},e=Math.floor(c.pos.x/this.cellSize),f=Math.floor(c.pos.y/this.cellSize),g=Math.floor((c.pos.x+c.size.x)/this.cellSize)+1,h=Math.floor((c.pos.y+c.size.y)/this.cellSize)+1;for(var i=e;i<g;i++)for(var j=f;j<h;j++)if(!a[i])a[i]={},a[i][j]=[c];else if(!a[i][j])a[i][j]=[c];else{var k=a[i][j];for(var l=0;l<k.length;l++)c.touches(k[l])&&!d[k[l].id]&&(d[k[l].id]=!0,ig.Entity.checkPair(c,k[l]));k.push(c)}}}}),ig.Game.SORT={Z_INDEX:function(a,b){return a.zIndex-b.zIndex},POS_X:function(a,b){return a.pos.x+a.size.x-(b.pos.x+b.size.x)},POS_Y:function(a,b){return a.pos.y+a.size.y-(b.pos.y+b.size.y)}}}),ig.baked=!0,ig.module("plugins.gui").requires("impact.game").defines(function(){ig.gui={show:!0,initialized:!1,cursor:{pos:{x:0,y:0},offset:{x:0,y:0},image:null,set:function(a){this.image=a},clear:function(){this.image=null},draw:function(){this.image!=null&&this.image.draw(this.pos.x-this.offset.x,this.pos.y-this.offset.y)}},elements:[],element:{action:function(a,b){var c=[];for(var d=0;d<ig.gui.elements.length;d++)a=="getByName"&&ig.gui.elements[d].name==b&&c.push(ig.gui.elements[d]),a=="getByGroup"&&ig.gui.elements[d].group==b&&c.push(ig.gui.elements[d]),a=="show"&&ig.gui.elements[d].name==b&&(ig.gui.elements[d].show=!0),a=="showGroup"&&ig.gui.elements[d].group==b&&(ig.gui.elements[d].show=!0),a=="hide"&&ig.gui.elements[d].name==b&&(ig.gui.elements[d].show=!1),a=="hideGroup"&&ig.gui.elements[d].group==b&&(ig.gui.elements[d].show=!1),a=="remove"&&ig.gui.elements[d].name==b&&ig.gui.elements.erase(ig.gui.elements[d]),a=="removeGroup"&&ig.gui.elements[d].group==b&&ig.gui.elements.erase(ig.gui.elements[d]),a=="enable"&&ig.gui.elements[d].name==b&&(ig.gui.elements[d].disable=!1),a=="enableGroup"&&ig.gui.elements[d].group==b&&(ig.gui.elements[d].disable=!1),a=="enable"&&ig.gui.elements[d].name==b&&(ig.gui.elements[d].disable=!0),a=="enableGroup"&&ig.gui.elements[d].group==b&&(ig.gui.elements[d].disable=!0),a=="disableAll"&&(ig.gui.elements[d].disable=!0);if(c.length)return c.length==1&&(c=c[0]),c},add:function(a){a.show==undefined&&(a.show=!0),a.disabled==undefined&&(a.disabled=!1),a.active==undefined&&(a.active=!1),ig.gui.elements.push(a)},draw:function(){for(var a=0;a<ig.gui.elements.length;a++){var b=ig.gui.elements[a],c="normal";if(!b.show)continue;ig.gui.cursor.pos.x>=b.pos.x&&ig.gui.cursor.pos.x<=b.pos.x+b.size.x&&ig.gui.cursor.pos.y>=b.pos.y&&ig.gui.cursor.pos.y<=b.pos.y+b.size.y&&!b.disabled&&(c="hover"),c=="hover"&&(ig.input.state("mouse1")||ig.input.pressed("mouse1"))&&(c="active",ig.input.state("mouse1")&&typeof ig.gui.elements[a].mouseDown=="function"&&ig.gui.elements[a].mouseDown.call(b),ig.input.pressed("mouse1")&&(b.toggle&&(b.active=!b.active),typeof ig.gui.elements[a].click=="function"&&ig.gui.elements[a].click.call(b))),b.toggle&&b.active&&(c="active"),ig.gui.elements[a].state[c]==undefined&&(c="normal"),b.alpha!=undefined&&(ig.system.context.globalAlpha=b.alpha);var d=ig.gui.elements[a].state[c];isNaN(d.tile)||isNaN(d.tileSize)?d.image.draw(b.pos.x,b.pos.y):d.image.drawTile(b.pos.x,b.pos.y,d.tile,d.tileSize),ig.system.context.globalAlpha=1}}},draw:function(){this.element.draw(),this.cursor.pos={x:ig.input.mouse.x,y:ig.input.mouse.y},this.cursor.draw()}},ig.Game.inject({update:function(){this.parent();if(ig.gui.initialized)return;ig.gui.initialized=!0,ig.input.bind(ig.KEY.MOUSE1,"mouse1")}})}),ig.baked=!0,ig.module("plugins.camera").requires("impact.impact").defines(function(){Camera=ig.Class.extend({trap:{pos:{x:0,y:0},size:{x:16,y:16}},max:{x:0,y:0},offset:{x:0,y:0},pos:{x:0,y:0},damping:5,lookAhead:{x:0,y:0},currentLookAhead:{x:0,y:0},debug:!1,init:function(a,b,c){this.offset.x=a,this.offset.y=b,this.damping=c},set:function(a){this.pos.x=a.pos.x-this.offset.x,this.pos.y=a.pos.y-this.offset.y,this.trap.pos.x=a.pos.x-this.trap.size.x/2,this.trap.pos.y=a.pos.y-this.trap.size.y},follow:function(a){this.pos.x=this.move("x",a.pos.x,a.size.x),this.pos.y=this.move("y",a.pos.y,a.size.y),ig.game.screen.x=this.pos.x,ig.game.screen.y=this.pos.y},move:function(a,b,c){var d=0;return b<this.trap.pos[a]?(this.trap.pos[a]=b,this.currentLookAhead[a]=this.lookAhead[a]):b+c>this.trap.pos[a]+this.trap.size[a]&&(this.trap.pos[a]=b+c-this.trap.size[a],this.currentLookAhead[a]=-this.lookAhead[a]),(this.pos[a]-(this.pos[a]-this.trap.pos[a]+this.offset[a]+this.currentLookAhead[a])*ig.system.tick*this.damping).limit(0,this.max[a])},draw:function(){this.debug&&(ig.system.context.fillStyle="rgba(255,0,255,0.3)",ig.system.context.fillRect((this.trap.pos.x-this.pos.x)*ig.system.scale,(this.trap.pos.y-this.pos.y)*ig.system.scale,this.trap.size.x*ig.system.scale,this.trap.size.y*ig.system.scale))}})}),ig.baked=!0,ig.module("game.entities.player").requires("impact.entity","plugins.camera").defines(function(){EntityPlayer=ig.Entity.extend({size:{x:32,y:36},maxVel:{x:80,y:80},friction:{x:600,y:600},type:ig.Entity.TYPE.A,checkAgainst:ig.Entity.TYPE.NONE,collides:ig.Entity.COLLIDES.PASSIVE,animSheet:new ig.AnimationSheet("/assets/dungeoneer_media/player.png",32,36),flip:!1,health:10,flip:!1,init:function(a,b,c){this.parent(a,b,c),this.addAnim("idle",1,[6]),this.addAnim("up",.07,[0,1,2]),this.addAnim("down",.07,[6,7,8]),this.addAnim("right",.07,[3,4,5]),ig.game.player=this},update:function(){ig.input.state("left")?(this.vel.x=-this.maxVel.x,this.flip=!0):ig.input.state("right")?(this.vel.x=this.maxVel.x,this.flip=!1):ig.input.state("up")?(this.vel.y=-this.maxVel.y,this.flip=!1):ig.input.state("down")?(this.vel.y=this.maxVel.y,this.flip=!1):(this.vel.x=0,this.vel.y=0),this.vel.y<0?this.currentAnim=this.anims.up:this.vel.y>0?this.currentAnim=this.anims.down:this.vel.x!=0?this.currentAnim=this.anims.right:this.currentAnim=this.anims.idle,this.currentAnim.flip.x=this.flip,this.parent()}})}),ig.baked=!0,ig.module("game.levels.test").requires("impact.image","game.entities.player").defines(function(){LevelTest={entities:[{type:"EntityPlayer",x:52,y:52}],layer:[{name:"ground",width:16,height:16,linkWithCollision:!1,visible:1,tilesetName:"/assets/dungeoneer_media/16tiles.png",repeat:!1,preRender:!1,distance:"1",tilesize:32,foreground:!1,data:[[175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175],[175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175],[175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175],[175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175],[175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175],[175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175],[175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175],[175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175],[175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175],[175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175],[175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175],[175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175],[175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175],[175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175],[175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175],[175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175]]},{name:"walls",width:16,height:16,linkWithCollision:!1,visible:1,tilesetName:"/assets/dungeoneer_media/16tiles.png",repeat:!1,preRender:!1,distance:"1",tilesize:32,foreground:!1,data:[[173,173,173,173,173,173,173,54,173,173,173,173,173,173,173,173],[173,0,0,0,0,0,0,0,0,0,0,0,0,0,0,173],[173,0,0,0,0,0,0,0,0,0,0,0,0,0,0,173],[173,0,0,0,0,0,0,0,0,0,0,0,0,0,0,173],[173,0,0,0,0,0,0,0,0,0,0,0,0,0,0,173],[173,0,0,0,0,0,0,0,0,0,0,0,0,0,0,173],[173,0,0,0,0,0,0,0,0,0,0,0,0,0,0,173],[173,0,0,0,0,0,0,0,0,0,0,0,0,0,0,173],[173,0,0,0,0,0,0,0,0,0,0,0,0,0,0,173],[173,0,0,0,0,0,0,0,0,0,0,0,0,0,0,173],[173,0,0,0,0,0,0,0,0,0,0,0,0,0,0,173],[173,0,0,0,0,0,0,0,0,0,0,0,0,0,0,173],[173,0,0,0,0,0,0,0,0,0,0,0,0,0,0,173],[173,0,0,0,0,0,0,0,0,0,0,0,0,0,0,173],[173,0,0,0,0,0,0,0,0,0,0,0,0,0,0,173],[173,173,173,173,173,173,173,173,173,173,173,173,173,173,173,173]]},{name:"collision",width:16,height:16,linkWithCollision:!1,visible:1,tilesetName:"",repeat:!1,preRender:!1,distance:1,tilesize:32,foreground:!1,data:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]}]},LevelTestResources=[new ig.Image("/assets/dungeoneer_media/16tiles.png"),new ig.Image("/assets/dungeoneer_media/16tiles.png")]}),ig.baked=!0,ig.module("game.main").requires("impact.game","impact.font","plugins.gui","plugins.camera","game.levels.test","game.entities.player").defines(function(){MyGame=ig.Game.extend({gravity:0,font:new ig.Font("/assets/dungeoneer_media/04b03.font.png"),crosshair:new ig.Image("/assets/dungeoneer_media/crosshair.png"),init:function(){this.camera=new Camera(ig.system.width/3,ig.system.height/3,5),this.camera.trap.size.x=ig.system.width/10,this.camera.trap.size.y=ig.system.height/3,this.camera.lookAhead.x=ig.ua.mobile?ig.system.width/6:0,ig.input.bind(ig.KEY.LEFT_ARROW,"left"),ig.input.bind(ig.KEY.RIGHT_ARROW,"right"),ig.input.bind(ig.KEY.UP_ARROW,"up"),ig.input.bind(ig.KEY.DOWN_ARROW,"down"),ig.gui.cursor.set(this.crosshair),ig.gui.cursor.offset={x:8,y:8},this.loadLevel(LevelTest)},loadLevel:function(a){this.parent(a);var b=this.getEntitiesByType(EntityPlayer)[0];this.camera.max.x=this.collisionMap.width*this.collisionMap.tilesize-ig.system.width,this.camera.max.y=this.collisionMap.height*this.collisionMap.tilesize-ig.system.height,this.camera.set(b)},update:function(){var a=this.getEntitiesByType(EntityPlayer)[0];a&&this.camera.follow(a),this.parent()},draw:function(){this.parent(),this.font.draw("Arrow Keys",2,2),ig.gui.show&&ig.gui.draw()}}),ig.main("#dungeoneer",MyGame,60,360,240,2)});